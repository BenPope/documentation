---
title: IAM Roles
---

IAM roles provide a safer alternative to the less secure credential system by supplying temporary credentials to a role for the duration of a session. These credentials allow you to access the data stored in an S3 bucket.

:::note

When using Tiered Storage for an on-premises cluster, you must still use credentials. IAM roles cannot be used in this case.

:::

## Prerequisites

Before you can configure IAM roles in Redpanda, you must create the IAM role that will be used to access the S3 storage bucket. The following steps use Amazon Web Services (AWS) terminology, but they apply to Google Cloud Platform (GCP) as well:
1. Create an S3 storage bucket.
2. Create an IAM policy.
3. Create an IAM role and assign the policy to that role.
4. Bind the VM, or pod in the case of Kubernetes, to the IAM role by following your cloud provider's instructions.

## Sample IAM policies

An IAM policy specifies which operations can be performed, such as writing to and reading from an S3 bucket, and which resources can be accessed. The following example policy grants all permissions associated with any S3 bucket, and full access to all resources. This particular example also includes all permissions associated with `s3-object-lambda`, which you can use to perform operations on the data in the S3 bucket.

```
# AmazonS3FullAccess
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:*",
                "s3-object-lambda:*"
            ],
            "Resource": "*"
        }
    ]
}
```

A more restrictive IAM policy is shown below. This policy only allows a user to get and list objects in the `test` S3 bucket.

```
# AmazonS3ReadOnlyAccess
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:Get*",
                "s3:List*",
                "s3-object-lambda:Get*",
                "s3-object-lambda:List*"
            ],
            "Resource": "arn:aws:s3:::test"
        }
    ]
}
```

For tips on writing an IAM policy, see this [AWS blog post](https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/).

## Configuring IAM roles

Once you complete the prerequisites, edit the Redpanda cluster configuration and set the [`Cloud_storage_credentials_source`](https://docs.redpanda.com/docs/reference/cluster-properties/#cloud-storage) property to the appropriate value for your use case. The following table shows all possible values and their descriptions.

| Value       | Description |
| ----------- | ----------- |
| `config_file` (default) | If IAM roles are not available, specify credentials in the configuration file.|
| `aws_instance_metadata` | For an AWS EC2 instance, use the instance metadata API from AWS.|
| `sts` |For AWS on Kubernetes, use the Secure Token Service (STS) to obtain a token from the pod.|
| `gcp_instance_metadata` |For a VM running on GCP, or for Google Kubernetes Engine (GKE), use the instance metadata API from GCP.|